longitude = longitude...4) %>%
dplyr::select(- contains("simulation...")) %>%
dplyr::select(- contains("projection...")) %>%
dplyr::select(- contains("latitude...")) %>%
dplyr::select(- contains("longitude..."))
names(sims_historical_dfs)
ROMS_hindcast_dat_current <- ROMS_hindcast_dat %>%
filter(., year != 2020)
# summarize data into year bins
# create a list of year bins
year_bins  <- list('1970_1979' = c(1970:1979),
'1980_1989' = c(1980:1989),
'1990_1999' = c(1990:1999),
'2000_2009' = c(2000:2009),
'2010_2019' = c(2010:2019))
# create a list of dfs summarized by year bins
sum_yr_bin <- function(x){
df <- ROMS_hindcast_dat_current %>%
filter(year %in% x) %>%
group_by(longitude, latitude) %>%
summarise(mean_hs = mean(hatch_success_cauchy),
mean_temp = mean(temp),
mean_sphabsuit = mean(sp_hab_suit))
df
}
df_list <- lapply(year_bins, sum_yr_bin)
# add a column of the year bin
df_list_tp <- mapply(cbind, df_list, "time_period"= names(year_bins), SIMPLIFY = FALSE)
ROMS_hindcast_dat_current_sum <- bind_rows(df_list_tp) %>%
dplyr::select(latitude, longitude, mean_sphabsuit, time_period)
year_list  <- list('1970_1979',
'1980_1989',
'1990_1999',
'2000_2009',
'2010_2019')
reshape_func <- function(x){
new_dat <- ROMS_hindcast_dat_current_sum %>% filter(., time_period == x)
new_dat <- new_dat %>%
rename(!!paste0("mean_sphabsuit_", x) := mean_sphabsuit) %>%
dplyr::select(- time_period)
new_dat
}
df_list <- lapply(year_list, reshape_func)
sp_yr_sum <- bind_cols(df_list)
sp_yr_sum <- sp_yr_sum %>%
rename(latitude = latitude...1,
longitude = longitude...2)
sp_yr_sum <- dplyr::select(sp_yr_sum, - contains(c("latitude..", "longitude..")))
View(sp_yr_sum)
sp_yr_sum2 <- sp_yr_sum %>%
rowwise() %>%
mutate( pct_change1 =
(mean_sphabsuit_1980_1989 - mean_sphabsuit_1970_1979),
pct_change2 =
(mean_sphabsuit_1990_1999 - mean_sphabsuit_1980_1989),
pct_change3 =
(mean_sphabsuit_2000_2009 - mean_sphabsuit_1990_1999),
pct_change4 =
(mean_sphabsuit_2010_2019 - mean_sphabsuit_2000_2009)
)
View(sp_yr_sum2)
names(sims_historical_dfs)
ROMS_projected_dat_yr_sum <- ROMS_projected_dat %>%
group_by(simulation, projection, year, latitude, longitude) %>%
summarise(mean_sphabsuit = mean(sp_hab_suit_var))
ROMS_projected_dat_yr_sum <- ROMS_projected_dat_yr_sum %>%
mutate(decade = case_when(
between(year, 1980, 1989) ~ "1980s",
between(year, 1990, 1999) ~ "1990s",
between(year, 2000, 2009) ~ "2000s",
between(year, 2010, 2014) ~ "early 2010s",
between(year, 2015, 2019) ~ "late 2010s",
between(year, 2020, 2029) ~ "2020s",
between(year, 2030, 2039) ~ "2030s",
between(year, 2040, 2049) ~ "2040s",
between(year, 2050, 2059) ~ "2050s",
between(year, 2060, 2069) ~ "2060s",
between(year, 2070, 2079) ~ "2070s",
between(year, 2080, 2089) ~ "2080s",
between(year, 2090, 2099) ~ "2090s"
))
ROMS_projected_dat_yr_sum <- ROMS_projected_dat_yr_sum %>%
mutate(decade = case_when(
between(year, 1985, 1994) ~ "1980s",
between(year, 1995, 2004) ~ "1990s",
between(year, 2005, 2014) ~ "2000s",
between(year, 2015, 2024) ~ "early 2010s",
between(year, 2025, 2034) ~ "late 2010s",
between(year, 2035, 2044) ~ "2020s",
between(year, 2045, 2054) ~ "2030s",
between(year, 2055, 2064) ~ "2040s",
between(year, 2065, 2074) ~ "2050s",
between(year, 2075, 2084) ~ "2060s",
between(year, 2085, 2094) ~ "2070s",
))
# load each time
#### libraries ####
library(here)
library(rnaturalearth)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(data.table)
library(sf)
library(forcats)
library(lubridate)
library(patchwork)
library(raster)
library(rgdal)
library(stars)
library(marmap)
library(zoo)
library(RColorBrewer)
library(beepr)
library(mapdata)
# turn off spherical geometry
sf_use_s2(FALSE)
# create object for greater than or equal to symbol
symbol<-"\u2265"
#### load and transform data ####
# hindcast data
ROMS_hindcast_dat  <- fread(file = "./data/ROMS_hindcast_dat.csv") %>% filter(., year != 2021)
# projected data
ROMS_projected_dat <- fread(file = "./data/ROMS_projected_dat.csv") %>%
mutate(latitude = Lat,
longitude = Lon)
# add name of month for plotting
ROMS_projected_dat$month_name <- NA
ROMS_projected_dat$month_name[ROMS_projected_dat$month == 1] <- "January"
ROMS_projected_dat$month_name[ROMS_projected_dat$month == 2] <- "February"
ROMS_projected_dat$month_name[ROMS_projected_dat$month == 3] <- "March"
ROMS_projected_dat$month_name[ROMS_projected_dat$month == 4] <- "April"
#
#	## add in area and depth
#
#	area_depth_df <- ROMS_hindcast_dat %>%
#		dplyr::select(latitude, longitude, depth, area_km2)
#
#	ROMS_projected_dat <- merge(ROMS_projected_dat, area_depth_df,
#															 by = c("latitude", "longitude"))
#
# reorder for plotting
ROMS_hindcast_dat$month_name <- factor(ROMS_hindcast_dat$month_name)
ROMS_hindcast_dat$month_name <- fct_reorder(ROMS_hindcast_dat$month_name,
ROMS_hindcast_dat$month)
ROMS_projected_dat$month_name <- factor(ROMS_projected_dat$month_name)
ROMS_projected_dat$month_name <- fct_reorder(ROMS_projected_dat$month_name,
ROMS_projected_dat$month)
# convert to a shapefile
ROMS_hindcast_dat_sf <- ROMS_hindcast_dat %>%
st_as_sf(coords = c("long_not_360", "latitude"), crs = 4326, remove = FALSE)
ROMS_projected_dat_sf <- ROMS_projected_dat %>%
mutate(longitude = Lon,
latitude = Lat,
long_not_360 = case_when(
longitude >= 180 ~ longitude - 360,
longitude < 180 ~ longitude)) %>%
st_as_sf(coords = c("long_not_360", "latitude"), crs = 4326, remove = FALSE)
#### load map ####
world_map_data <- ne_countries(scale = "medium", returnclass = "sf")
#### plotting function ####
ggsave_func <- function(x,y){
ggsave(plot = x,
file = paste(y,".png",sep=""),
width = 10, height = 10, units = "in")
}
year_bins_proj <- list('1985_1994' = c(1985:1994),
'1995_2004' = c(1995:2004),
'2005_2014' = c(2000:2014),
'2015_2024' = c(2010:2024),
'2025_2034' = c(2015:2034),
'2035_2044' = c(2020:2044),
'2045_2054' = c(2030:2054),
'2055_2064' = c(2040:2064),
'2065_2074' = c(2050:2074),
'2075_2084' = c(2060:2084),
'2085_2094' = c(2070:2094))
# create a list of dfs summarized by year bins
sum_yr_bin <- function(x){
df <- ROMS_projected_dat %>%
filter(year %in% x) %>%
group_by(simulation, projection, longitude, latitude) %>%
summarise(mean_hs = mean(hatch_success_cauchy_var),
mean_temp = mean(bc_temp_sd),
mean_sphabsuit = mean(sp_hab_suit_var))
df
}
df_list <- lapply(year_bins_proj, sum_yr_bin)
# add a column of the year bin
df_list_tp <- mapply(cbind, df_list, "time_period"= names(year_bins_proj), SIMPLIFY = FALSE)
# bind all rows of all dfs together and add a column for longitude not on 360 scale
ROMS_projected_dat_yrs_sum <- bind_rows(df_list_tp) %>%
dplyr::select(simulation, projection, latitude, longitude, mean_sphabsuit, time_period)
year_list_proj <- list('1985_1994',
'1995_2004',
'2005_2014',
'2015_2024',
'2025_2034',
'2035_2044',
'2045_2054',
'2055_2064',
'2065_2074',
'2075_2084',
'2085_2094')
reshape_func <- function(x){
new_dat <- ROMS_projected_dat_yrs_sum %>% filter(., time_period == x)
new_dat <- new_dat %>%
rename(!!paste0("mean_sphabsuit_", x) := mean_sphabsuit) %>%
dplyr::select(- time_period)
new_dat
}
df_list_names <- lapply(year_list_proj, reshape_func)
sims_historical <- df_list_names[c(1:3)]
sims_historical_dfs <- bind_cols(sims_historical)
sims_historical_dfs <- sims_historical_dfs %>%
rename(simulation = simulation...1,
projection = projection...2,
latitude = latitude...3,
longitude = longitude...4) %>%
dplyr::select(- contains("simulation...")) %>%
dplyr::select(- contains("projection...")) %>%
dplyr::select(- contains("latitude...")) %>%
dplyr::select(- contains("longitude..."))
sims_historical_dfs <- merge(sims_historical_dfs, df_hist3)
sims_historical_dfs <- sims_historical_dfs %>%
rowwise() %>%
mutate( pct_change1 =
(mean_sphabsuit_1995_2004 - mean_sphabsuit_1985_1994),
pct_change2 =
(mean_sphabsuit_2005_2014 - mean_sphabsuit_1995_2004)
)
label = c("1985 to 1995",'1995 to 2005')
sims_historical_dfs <- sims_historical_dfs %>%
dplyr::select(- contains("mean_sphabsuit"))
sims_historical_dfs_long <- sims_historical_dfs %>%
gather(pct_change, value, -c("latitude", "longitude"))
sims_historical_dfs_long_sf <- sims_historical_dfs_long %>%
mutate(long_not_360 = longitude - 360) %>%
st_as_sf(coords = c("long_not_360", "latitude"), crs = 4326)
sims_historical_dfs_long_sf <- sims_historical_dfs_long_sf %>%
rename(time_period = pct_change,
pct_change = value)
sims_historical_dfs_long_sf$time_period <- str_replace(sims_historical_dfs_long_sf$time_period,
"pct_change_", "")
plot <-
ggplot() +
geom_sf(data = sims_historical_dfs_long_sf, aes(color = pct_change))  +
geom_sf(data = world_map_data, fill = "grey", lwd = 0) +
coord_sf(crs = 3338) +
facet_wrap(~ time_period, nrow = 1) +
scale_color_viridis_c() +
scale_x_continuous(
breaks = c(-175, -170, -165, -160),
labels = c("-175˚", "-170˚", "-165˚", "-160˚"),
name = "Longitude",
limits = c(-1400000, -150000)
) +
scale_y_continuous(
breaks = c(55, 60),
limits = c(470000, 1900000),
name = "Latitude",
) +
labs(colour = "% change in\nspawning habitat\nsuitability") +
theme_bw() +
theme(
strip.background = element_blank(),
strip.text = element_blank(),
axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.title.align=0.5)
ggsave("./output/plots/percent change_proj.png",
plot,
width = 20, height = 10, units = "in")
str(sims_historical_dfs_long_sf)
View(sims_historical_dfs_long_sf)
sims_historical <- df_list_names[c(1:3)]
sims_historical_dfs <- bind_cols(sims_historical)
sims_historical_dfs <- sims_historical_dfs %>%
rename(simulation = simulation...1,
projection = projection...2,
latitude = latitude...3,
longitude = longitude...4) %>%
dplyr::select(- contains("simulation...")) %>%
dplyr::select(- contains("projection...")) %>%
dplyr::select(- contains("latitude...")) %>%
dplyr::select(- contains("longitude..."))
sims_historical_dfs <- merge(sims_historical_dfs, df_hist3)
sims_historical_dfs <- sims_historical_dfs %>%
rowwise() %>%
mutate( pct_change1 =
(mean_sphabsuit_1995_2004 - mean_sphabsuit_1985_1994),
pct_change2 =
(mean_sphabsuit_2005_2014 - mean_sphabsuit_1995_2004)
)
names(sims_historical_dfs)
label = c("1985 to 1995",'1995 to 2005')
sims_historical_dfs <- sims_historical_dfs %>%
dplyr::select(- contains("mean_sphabsuit"))
View(sims_historical_dfs)
sims_historical_dfs <- sims_historical_dfs %>%
rowwise() %>%
mutate( pct_change_1985_1995=
(mean_sphabsuit_1995_2004 - mean_sphabsuit_1985_1994),
pct_change_1995_2005 =
(mean_sphabsuit_2005_2014 - mean_sphabsuit_1995_2004)
)
sims_historical_dfs <- merge(sims_historical_dfs, df_hist3)
sims_historical_dfs <- sims_historical_dfs %>%
rowwise() %>%
mutate( pct_change_1985_1995=
(mean_sphabsuit_1995_2004 - mean_sphabsuit_1985_1994),
pct_change_1995_2005 =
(mean_sphabsuit_2005_2014 - mean_sphabsuit_1995_2004)
)
sims_historical_dfs <- merge(sims_historical_dfs, df_hist3)
sims_historical <- df_list_names[c(1:3)]
sims_historical_dfs <- bind_cols(sims_historical)
sims_historical_dfs <- sims_historical_dfs %>%
rename(simulation = simulation...1,
projection = projection...2,
latitude = latitude...3,
longitude = longitude...4) %>%
dplyr::select(- contains("simulation...")) %>%
dplyr::select(- contains("projection...")) %>%
dplyr::select(- contains("latitude...")) %>%
dplyr::select(- contains("longitude..."))
sims_historical_dfs <- sims_historical_dfs %>%
rowwise() %>%
mutate( pct_change_1985_1995=
(mean_sphabsuit_1995_2004 - mean_sphabsuit_1985_1994),
pct_change_1995_2005 =
(mean_sphabsuit_2005_2014 - mean_sphabsuit_1995_2004)
)
label = c("1985 to 1995",'1995 to 2005')
sims_historical_dfs <- sims_historical_dfs %>%
dplyr::select(- contains("mean_sphabsuit"))
View(sims_historical_dfs)
sims_historical_dfs_long <- sims_historical_dfs %>%
gather(pct_change, value, -c("latitude", "longitude"))
View(sims_historical_dfs_long)
names(sims_historical_dfs)
sims_historical_dfs_long <- sims_historical_dfs %>%
gather(pct_change, value)
View(sims_historical_dfs_long)
sims_historical_dfs_long <- sims_historical_dfs %>%
gather(pct_change, value), -c("latitude", "longitude"))
View(sims_historical_dfs_long)
sims_historical_dfs_long <- sims_historical_dfs %>%
gather(pct_change, value, -c("latitude", "longitude"))
View(sims_historical_dfs_long)
names(sims_historical_dfs_long)
sims_historical_dfs_long <- sims_historical_dfs %>%
gather(pct_change, value, -c("latitude", "longitude", "simulation", "projection"))
View(sims_historical_dfs_long)
sims_historical_dfs_long_sf <- sims_historical_dfs_long %>%
mutate(long_not_360 = longitude - 360) %>%
st_as_sf(coords = c("long_not_360", "latitude"), crs = 4326)
sims_historical_dfs_long_sf <- sims_historical_dfs_long_sf %>%
rename(time_period = pct_change,
pct_change = value)
sims_historical_dfs_long_sf$time_period <- str_replace(sims_historical_dfs_long_sf$time_period,
"pct_change_", "")
View(sims_historical_dfs_long_sf)
ggplot() +
geom_sf(data = sims_historical_dfs_long_sf, aes(color = pct_change))  +
geom_sf(data = world_map_data, fill = "grey", lwd = 0) +
coord_sf(crs = 3338) +
facet_wrap(~ time_period, nrow = 1) +
scale_color_viridis_c() +
scale_x_continuous(
breaks = c(-175, -170, -165, -160),
labels = c("-175˚", "-170˚", "-165˚", "-160˚"),
name = "Longitude",
limits = c(-1400000, -150000)
) +
scale_y_continuous(
breaks = c(55, 60),
limits = c(470000, 1900000),
name = "Latitude",
) +
labs(colour = "% change in\nspawning habitat\nsuitability") +
theme_bw() +
theme(
strip.background = element_blank(),
strip.text = element_blank(),
axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.title.align=0.5)
plot <-
ggplot() +
geom_sf(data = sims_historical_dfs_long_sf, aes(color = pct_change))  +
geom_sf(data = world_map_data, fill = "grey", lwd = 0) +
coord_sf(crs = 3338) +
facet_grid(simulation + projection ~ time_period, nrow = 1) +
scale_color_viridis_c() +
scale_x_continuous(
breaks = c(-175, -170, -165, -160),
labels = c("-175˚", "-170˚", "-165˚", "-160˚"),
name = "Longitude",
limits = c(-1400000, -150000)
) +
scale_y_continuous(
breaks = c(55, 60),
limits = c(470000, 1900000),
name = "Latitude",
) +
labs(colour = "% change in\nspawning habitat\nsuitability") +
theme_bw() +
theme(
strip.background = element_blank(),
strip.text = element_blank(),
axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.title.align=0.5)
ggsave("./output/plots/percent change_proj.png",
plot,
width = 20, height = 10, units = "in")
plot <-
ggplot() +
geom_sf(data = sims_historical_dfs_long_sf, aes(color = pct_change))  +
geom_sf(data = world_map_data, fill = "grey", lwd = 0) +
coord_sf(crs = 3338) +
facet_grid(simulation + projection ~ time_period) +
scale_color_viridis_c() +
scale_x_continuous(
breaks = c(-175, -170, -165, -160),
labels = c("-175˚", "-170˚", "-165˚", "-160˚"),
name = "Longitude",
limits = c(-1400000, -150000)
) +
scale_y_continuous(
breaks = c(55, 60),
limits = c(470000, 1900000),
name = "Latitude",
) +
labs(colour = "% change in\nspawning habitat\nsuitability") +
theme_bw() +
theme(
strip.background = element_blank(),
strip.text = element_blank(),
axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.title.align=0.5)
ggsave("./output/plots/percent change_proj.png",
plot,
width = 20, height = 10, units = "in")
plot <-
ggplot() +
geom_sf(data = sims_historical_dfs_long_sf, aes(color = pct_change))  +
geom_sf(data = world_map_data, fill = "grey", lwd = 0) +
coord_sf(crs = 3338) +
facet_grid(simulation + projection ~ time_period) +
scale_color_viridis_c() +
scale_x_continuous(
breaks = c(-175, -170, -165, -160),
labels = c("-175˚", "-170˚", "-165˚", "-160˚"),
name = "Longitude",
limits = c(-1400000, -150000)
) +
scale_y_continuous(
breaks = c(55, 60),
limits = c(470000, 1900000),
name = "Latitude",
) +
labs(colour = "% change in\nspawning habitat\nsuitability") +
theme_bw() +
theme(
strip.background = element_blank(),
strip.text = element_blank(),
axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.title.align=0.5)
ggsave("./output/plots/percent change_proj.png",
plot,
width = 20, height = 10, units = "in")
plot <-
ggplot() +
geom_sf(data = sims_historical_dfs_long_sf, aes(color = pct_change))  +
geom_sf(data = world_map_data, fill = "grey", lwd = 0) +
coord_sf(crs = 3338) +
facet_grid(simulation + projection ~ time_period) +
scale_color_viridis_c() +
scale_x_continuous(
breaks = c(-175, -170, -165, -160),
labels = c("-175˚", "-170˚", "-165˚", "-160˚"),
name = "Longitude",
limits = c(-1400000, -150000)
) +
scale_y_continuous(
breaks = c(55, 60),
limits = c(470000, 1900000),
name = "Latitude",
) +
labs(colour = "% change in\nspawning habitat\nsuitability") +
theme_bw() +
theme(
strip.background = element_blank(),
strip.text = element_text(size = 14),
axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.title.align=0.5)
ggsave("./output/plots/percent change_proj.png",
plot,
width = 20, height = 10, units = "in")
df4 <- df_list_names[[4]]
View(df4)
df5 <- df_list_names[[5]]
View(df5)
df11 <- df_list_names[[11]]
View(df11)
df_list_names <- lapply(year_list_proj, reshape_func)
View(df_list_names)
